lock
call cleanup function
unlock
